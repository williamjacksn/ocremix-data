name: Update ReMix info

on:
  schedule:
    - cron: 30 * * * *
  workflow_dispatch:
    inputs:
      limit:
        default: 10
        description: Number of ReMixes to update
        required: true
        type: number

jobs:
  update-remix-info:
    name: Update ReMix info
    runs-on: ubuntu-latest
    permissions:
      actions: write
      contents: write
    steps:
      - name: Check out repository
        uses: actions/checkout@v5

      - name: Install uv
        run: sh ci/install-uv.sh

      - name: Update ReMix info (on schedule)
        if: github.event_name == 'schedule'
        run: uv run ocremixdata.py update

      - name: Update ReMix info (on workflow_dispatch)
        if: github.event_name == 'workflow_dispatch'
        run: 'uv run ocremixdata.py update --limit ${{ inputs.limit }}'

      - name: Commit and push if changes
        id: commit
        run: sh ci/commit-and-push.sh
        env:
          COMMIT_MESSAGE: Update ReMix info

      - name: Dispatch workflow to build pages
        if: steps.commit.outputs.pushed == 'true'
        run: gh workflow run github-pages.yaml
        env:
          GH_TOKEN: '${{ github.token }}'
